<script>
  const CORRECT_PIN = "1644"; // 🔐

  const lock = document.getElementById('lockScreen');
  const input = document.getElementById('pinInput');
  const btn   = document.getElementById('unlockBtn');
  const msg   = document.getElementById('msg');

  function validate(){
    if(input.value === CORRECT_PIN){
      msg.textContent = 'ACCESS GRANTED';
      msg.style.color = '#00ffea';
      lock.classList.add('hidden');
      setTimeout(()=>{ 
        lock.style.display='none';
        fetchPrediction(); // carica predizioni
      }, 1000);
    }else{
      msg.textContent = 'ACCESS DENIED';
      msg.style.color = 'var(--danger)';
      input.value = '';
      lock.classList.add('shake');
      setTimeout(()=> lock.classList.remove('shake'), 400);
    }
  }

  btn.addEventListener('click', validate);
  input.addEventListener('keypress', e=>{ if(e.key==='Enter') validate(); });

  function fetchPrediction() {
    fetch('/api/predict-texts')
      .then(res => res.json())
      .then(data => {
        const blog = document.getElementById('blog');
        if (data.length > 0) {
          const latest = data[0];
          const newArticle = document.createElement('article');
          newArticle.innerHTML = `
            <h2>🧠 Ultima Predizione</h2>
            <p>
              <strong>Label:</strong> ${latest.label}<br>
              <strong>Confidence:</strong> ${latest.confidence}<br>
              <strong>Timestamp:</strong> ${new Date(latest.timestamp).toLocaleString()}
            </p>`;
          blog.prepend(newArticle);
        }
      });
  }
</script>
